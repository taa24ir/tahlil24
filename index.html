<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نرم افزار تحلیل داده‌های مطالعاتی - آکادمی دکتر افشارمنش</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Vazirmatn:wght@100;200;300;400;500;600;700;800;900&display=swap');
        
        :root {
            --primary-gradient: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            --secondary-gradient: linear-gradient(135deg, #0ba360 0%, #3cba92 100%);
            --accent-gradient: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%);
        }
        
        body {
            font-family: 'Vazirmatn', sans-serif;
            background-color: #f8f9fa;
            color: #343a40;
            padding-top: 20px;
        }
        
        .header {
            background: var(--primary-gradient);
            color: white;
            padding: 2rem 0;
            margin-bottom: 2rem;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        }
        
        .academy-title {
            font-size: 2.2rem;
            font-weight: 800;
            margin-bottom: 0.5rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .academy-link {
            color: #e0e0ff;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s;
        }
        
        .academy-link:hover {
            color: white;
            text-decoration: underline;
        }
        
        .card {
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            border: none;
            transition: transform 0.3s;
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .card-header {
            background: var(--primary-gradient);
            color: white;
            border-radius: 15px 15px 0 0 !important;
            font-weight: 600;
            padding: 1rem 1.5rem;
        }
        
        .btn-primary {
            background: var(--primary-gradient);
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            font-weight: 500;
        }
        
        .btn-success {
            background: var(--secondary-gradient);
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            font-weight: 500;
        }
        
        .btn-danger {
            background: var(--accent-gradient);
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            font-weight: 500;
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #ff9800 0%, #ff5722 100%);
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            font-weight: 500;
            color: white;
        }
        
        .btn-primary:hover, .btn-success:hover, .btn-danger:hover, .btn-warning:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        .form-control {
            border-radius: 8px;
            padding: 12px 15px;
            border: 1px solid #ced4da;
        }
        
        .form-control:focus {
            box-shadow: 0 0 0 0.25rem rgba(38, 117, 252, 0.25);
            border-color: #2575fc;
        }
        
        .table th {
            background-color: #6a11cb;
            color: white;
        }
        
        .chart-container {
            position: relative;
            height: 300px;
            margin-bottom: 30px;
        }
        
        .student-id-badge {
            background: var(--primary-gradient);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: 500;
        }
        
        .instructions {
            background-color: #e9ecef;
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
        }
        
        .poem-container {
            background: linear-gradient(135deg, #fdfcfb 0%, #e2d1c3 100%);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
            font-style: italic;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }
        
        .rating-input {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
        }
        
        .rating-input label {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
        }
        
        .rating-input input[type="radio"] {
            display: none;
        }
        
        .rating-input span {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #e9ecef;
            transition: all 0.3s;
        }
        
        .rating-input input[type="radio"]:checked + span {
            background: var(--primary-gradient);
            color: white;
            transform: scale(1.1);
        }
        
        .horizontal-report {
            width: 100%;
            min-height: 100vh;
            background: white;
            padding: 30px;
        }
        
        .report-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #6a11cb;
        }
        
        .report-charts {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .report-chart {
            flex: 1 1 45%;
            min-width: 300px;
            height: 300px;
        }
        
        .chart-analysis {
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            border-right: 4px solid #6a11cb;
        }
        
        .auth-container {
            background: var(--secondary-gradient);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            color: white;
            text-align: center;
        }
        
        .auth-input {
            max-width: 300px;
            margin: 0 auto;
        }
        
        .summary-box {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            text-align: center;
        }
        
        .summary-box h5 {
            font-size: 1rem;
            margin-bottom: 5px;
        }
        
        .summary-box p {
            font-size: 1.5rem;
            font-weight: bold;
            margin: 0;
        }
        
        .exam-checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .exam-checkbox {
            flex: 1;
            min-width: 120px;
        }
        
        .exam-checkbox input[type="checkbox"] {
            margin-left: 5px;
        }
        
        @media print {
            body * {
                visibility: hidden;
            }
            .horizontal-report, .horizontal-report * {
                visibility: visible;
            }
            .horizontal-report {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header text-center">
            <h1 class="academy-title">آکادمی تحصیلی دکتر احسان افشارمنش</h1>
            <p class="lead">نرم افزار تحلیل داده‌های مطالعاتی - نسخه پیشرفته</p>
            <a href="https://zil.ink/ehsan.afshar" class="academy-link" target="_blank">https://zil.ink/ehsan.afshar</a>
        </div>

        <div class="instructions">
            <h5>راهنما:</h5>
            <ol>
                <li>اطلاعات را وارد کرده و با دکمه "افزودن داده" ثبت کنید</li>
                <li>از دکمه "ورودی از اکسل" برای وارد کردن داده‌های حجیم استفاده کنید</li>
                <li>با دکمه "خروجی اکسل" داده‌های خام را برای استفاده‌های بعدی دریافت کنید</li>
                <li>گزارش گرافیکی، نمودارهای پیشرفت شما را نمایش می‌دهد</li>
            </ol>
        </div>

        <!-- بخش احراز هویت -->
        <div class="auth-container" id="authSection">
            <h4>ورود به سیستم</h4>
            <p>لطفاً کد دسترسی را وارد کنید</p>
            <div class="auth-input">
                <input type="password" class="form-control text-center" id="accessCode" placeholder="کد دسترسی">
                <button class="btn btn-light mt-3 w-100" onclick="checkAccessCode()">تایید و ورود به سیستم</button>
            </div>
        </div>

        <div id="mainContent" style="display: none;">
            <div class="row mb-4">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">ورودی اطلاعات</div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label for="studentCode" class="form-label">کد مراجع</label>
                                <input type="text" class="form-control" id="studentCode" placeholder="مثلاً: ST1001">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">شماره هفته برنامه</label>
                                <input type="number" class="form-control" id="weekNumber" placeholder="شماره هفته">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">ساعات مطالعه دروس تخصصی در هفته</label>
                                <input type="number" class="form-control" id="studyHoursSpecialized" placeholder="تعداد ساعت">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">تعداد تست تخصصی در هفته</label>
                                <input type="number" class="form-control" id="specializedTests" placeholder="تعداد تست">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">ساعات مطالعه دروس عمومی در هفته</label>
                                <input type="number" class="form-control" id="studyHoursGeneral" placeholder="تعداد ساعت">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">تعداد سوال تشریحی دروس عمومی در هفته</label>
                                <input type="number" class="form-control" id="descriptiveQuestions" placeholder="تعداد سوال">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">تعداد تست مارکدار شده در هفته</label>
                                <input type="number" class="form-control" id="markedTests" placeholder="تعداد تست">
                            </div>
                            
                            <!-- فیلد جدید: انتخاب نوع آزمون آزمایشی -->
                            <div class="mb-3">
                                <label class="form-label">نوع آزمون آزمایشی</label>
                                <div class="exam-checkbox-group">
                                    <div class="form-check exam-checkbox">
                                        <input class="form-check-input" type="checkbox" name="examType" value="ماز" id="examMaz">
                                        <label class="form-check-label" for="examMaz">ماز</label>
                                    </div>
                                    <div class="form-check exam-checkbox">
                                        <input class="form-check-input" type="checkbox" name="examType" value="قلمچی" id="examGalamchi">
                                        <label class="form-check-label" for="examGalamchi">قلمچی</label>
                                    </div>
                                    <div class="form-check exam-checkbox">
                                        <input class="form-check-input" type="checkbox" name="examType" value="گزینه2" id="examGozine2">
                                        <label class="form-check-label" for="examGozine2">گزینه۲</label>
                                    </div>
                                    <div class="form-check exam-checkbox">
                                        <input class="form-check-input" type="checkbox" name="examType" value="سنجش" id="examSanjesh">
                                        <label class="form-check-label" for="examSanjesh">سنجش</label>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- فیلد جدید: تراز آزمون آزمایشی -->
                            <div class="mb-3">
                                <label class="form-label">تراز آزمون آزمایشی</label>
                                <input type="number" class="form-control" id="examBalance" placeholder="تراز آزمون">
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">میزان رضایت از عملکرد</label>
                                <div class="rating-input">
                                    <label><input type="radio" name="satisfaction" value="1"><span>1</span></label>
                                    <label><input type="radio" name="satisfaction" value="2"><span>2</span></label>
                                    <label><input type="radio" name="satisfaction" value="3"><span>3</span></label>
                                    <label><input type="radio" name="satisfaction" value="4"><span>4</span></label>
                                    <label><input type="radio" name="satisfaction" value="5"><span>5</span></label>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">میزان رضایت از تعامل با مشاور</label>
                                <div class="rating-input">
                                    <label><input type="radio" name="advisorSatisfaction" value="1"><span>1</span></label>
                                    <label><input type="radio" name="advisorSatisfaction" value="2"><span>2</span></label>
                                    <label><input type="radio" name="advisorSatisfaction" value="3"><span>3</span></label>
                                    <label><input type="radio" name="advisorSatisfaction" value="4"><span>4</span></label>
                                    <label><input type="radio" name="advisorSatisfaction" value="5"><span>5</span></label>
                                </div>
                            </div>
                            
                            <button class="btn btn-primary w-100 mb-2" onclick="addData()">افزودن داده</button>
                            <button class="btn btn-warning w-100 mb-2" onclick="clearForm()">پاک کردن فرم</button>
                            <button class="btn btn-outline-primary w-100" onclick="loadExcelFile()">ورودی از اکسل</button>
                            <input type="file" id="excelInput" accept=".xlsx, .xls" style="display: none;">
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">خروجی و گزارش‌ها</div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label for="loadStudentCode" class="form-label">کد مراجع برای گزارش</label>
                                <input type="text" class="form-control" id="loadStudentCode" placeholder="مثلاً: ST1001">
                            </div>
                            
                            <div class="d-grid gap-2">
                                <button class="btn btn-success" onclick="generateReport()">گزارش گرافیکی</button>
                                <button class="btn btn-danger" onclick="exportToExcel()">خروجی اکسل</button>
                                <button class="btn btn-info text-white" onclick="exportToPDF()">خروجی PDF</button>
                                <button class="btn btn-warning" onclick="clearAllData()">پاک کردن همه داده‌ها</button>
                            </div>
                            
                            <div class="student-id-badge d-inline-block my-3">
                                دانشجوی انتخاب شده: <span id="selectedStudent">ST1001</span>
                            </div>
                        </div>
                    </div>

                    <!-- باکس‌های خلاصه عملکرد -->
                    <div class="card mt-4">
                        <div class="card-header">خلاصه عملکرد</div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="summary-box">
                                        <h5>جمع ساعات تخصصی</h5>
                                        <p id="totalSpecializedHours">0</p>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="summary-box">
                                        <h5>جمع ساعات عمومی</h5>
                                        <p id="totalGeneralHours">0</p>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="summary-box">
                                        <h5>جمع تست تخصصی</h5>
                                        <p id="totalSpecializedTests">0</p>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="summary-box">
                                        <h5>جمع سوال تشریحی</h5>
                                        <p id="totalDescriptiveQuestions">0</p>
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="summary-box">
                                        <h5>جمع تست مارکدار</h5>
                                        <p id="totalMarkedTests">0</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="row mb-4">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">داده‌های وارد شده</div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-striped table-hover">
                                    <thead>
                                        <tr>
                                            <th>کد مراجع</th>
                                            <th>هفته</th>
                                            <th>ساعات تخصصی</th>
                                            <th>تست تخصصی</th>
                                            <th>ساعات عمومی</th>
                                            <th>سوال تشریحی</th>
                                            <th>تست مارکدار</th>
                                            <th>نوع آزمون</th>
                                            <th>تراز آزمون</th>
                                            <th>رضایت عملکرد</th>
                                            <th>رضایت مشاور</th>
                                            <th>عملیات</th>
                                        </tr>
                                    </thead>
                                    <tbody id="dataTable">
                                        <!-- داده ها اینجا نمایش داده می شوند -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">نمودارهای تحلیلی</div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="chart-container">
                                        <canvas id="studyHoursChart"></canvas>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="chart-container">
                                        <canvas id="testCountChart"></canvas>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="chart-container">
                                        <canvas id="satisfactionChart"></canvas>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="chart-container">
                                        <canvas id="advisorSatisfactionChart"></canvas>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="chart-container">
                                        <canvas id="examBalanceChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <footer class="text-center py-4 mt-5 text-muted">
            <p>آکادمی تحصیلی دکتر احسان افشارمنش - نرم افزار تحلیل داده‌های مطالعاتی</p>
        </footer>
    </div>

    <!-- بخش گزارش گرافیکی (پنهان) -->
    <div id="graphicReport" class="horizontal-report" style="display: none;">
        <div class="report-header">
            <h1>آکادمی تحصیلی دکتر احسان افشارمنش</h1>
            <p>گزارش تحلیلی پیشرفت تحصیلی</p>
            <p>کد دانشجو: <span id="reportStudentCode"></span></p>
            <a href="https://zil.ink/ehsan.afshar" target="_blank">https://zil.ink/ehsan.afshar</a>
        </div>
        
        <div class="poem-container">
            <p id="inspirationalPoem">در حال دریافت شعر الهام بخش...</p>
        </div>

        <!-- خلاصه عملکرد در گزارش گرافیکی -->
        <div class="row mb-4">
            <div class="col-md-12">
                <h3>خلاصه عملکرد</h3>
                <div class="row">
                    <div class="col-md-2 col-6">
                        <div class="summary-box">
                            <h5>جمع ساعات تخصصی</h5>
                            <p id="reportTotalSpecializedHours">0</p>
                        </div>
                    </div>
                    <div class="col-md-2 col-6">
                        <div class="summary-box">
                            <h5>جمع ساعات عمومی</h5>
                            <p id="reportTotalGeneralHours">0</p>
                        </div>
                    </div>
                    <div class="col-md-2 col-6">
                        <div class="summary-box">
                            <h5>جمع تست تخصصی</h5>
                            <p id="reportTotalSpecializedTests">0</p>
                        </div>
                    </div>
                    <div class="col-md-2 col-6">
                        <div class="summary-box">
                            <h5>جمع سوال تشریحی</h5>
                            <p id="reportTotalDescriptiveQuestions">0</p>
                        </div>
                    </div>
                    <div class="col-md-2 col-6">
                        <div class="summary-box">
                            <h5>جمع تست مارکدار</h5>
                            <p id="reportTotalMarkedTests">0</p>
                        </div>
                    </div>
                    <div class="col-md-2 col-6">
                        <div class="summary-box">
                            <h5>تعداد هفته‌ها</h5>
                            <p id="reportTotalWeeks">0</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="report-charts">
            <div class="report-chart">
                <canvas id="reportStudyHoursChart"></canvas>
            </div>
            <div class="report-chart">
                <canvas id="reportTestCountChart"></canvas>
            </div>
            <div class="report-chart">
                <canvas id="reportSatisfactionChart"></canvas>
            </div>
            <div class="report-chart">
                <canvas id="reportAdvisorSatisfactionChart"></canvas>
            </div>
            <div class="report-chart">
                <canvas id="reportExamBalanceChart"></canvas>
            </div>
        </div>
        
        <div class="chart-analysis">
            <h4>تحلیل وضعیت تحصیلی</h4>
            <p id="studyAnalysisText">در حال تحلیل داده‌ها...</p>
        </div>
        
        <div class="chart-analysis">
            <h4>تحلیل وضعیت تست‌زنی</h4>
            <p id="testAnalysisText">در حال تحلیل داده‌ها...</p>
        </div>
        
        <div class="chart-analysis">
            <h4>تحلیل وضعیت رضایتمندی</h4>
            <p id="satisfactionAnalysisText">در حال تحلیل داده‌ها...</p>
        </div>
        
        <div class="chart-analysis">
            <h4>تحلیل تراز آزمون</h4>
            <p id="examBalanceAnalysisText">در حال تحلیل داده‌ها...</p>
        </div>
        
        <div class="text-center mt-4">
            <button class="btn btn-primary" onclick="window.print()">چاپ گزارش</button>
            <button class="btn btn-secondary" onclick="document.getElementById('graphicReport').style.display = 'none'">بستن گزارش</button>
        </div>
    </div>

    <script>
        // داده‌های نمونه
        let studyData = [];
        const ACCESS_CODE = "1213123"; // کد دسترسی
        
        // بررسی کد دسترسی
        function checkAccessCode() {
            const enteredCode = document.getElementById('accessCode').value;
            
            if (enteredCode === ACCESS_CODE) {
                document.getElementById('authSection').style.display = 'none';
                document.getElementById('mainContent').style.display = 'block';
                localStorage.setItem('isAuthenticated', 'true');
            } else {
                alert('کد دسترسی نامعتبر است. لطفاً دوباره تلاش کنید.');
            }
        }
        
        // بررسی وضعیت احراز هویت
        function checkAuthentication() {
            const isAuthenticated = localStorage.getItem('isAuthenticated');
            
            if (isAuthenticated === 'true') {
                document.getElementById('authSection').style.display = 'none';
                document.getElementById('mainContent').style.display = 'block';
            }
        }
        
        // بارگذاری داده‌های ذخیره شده در localStorage
        function loadSavedData() {
            const savedData = localStorage.getItem('studyData');
            if (savedData) {
                studyData = JSON.parse(savedData);
                updateDataTable();
                updateSummaryBoxes();
            }
        }
        
        // ذخیره داده‌ها در localStorage
        function saveData() {
            localStorage.setItem('studyData', JSON.stringify(studyData));
            updateSummaryBoxes();
        }
        
        // پاک کردن فرم
        function clearForm() {
            document.getElementById('weekNumber').value = '';
            document.getElementById('studyHoursSpecialized').value = '';
            document.getElementById('specializedTests').value = '';
            document.getElementById('studyHoursGeneral').value = '';
            document.getElementById('descriptiveQuestions').value = '';
            document.getElementById('markedTests').value = '';
            document.getElementById('examBalance').value = '';
            
            // پاک کردن انتخاب نوع آزمون
            document.querySelectorAll('input[name="examType"]').forEach(checkbox => {
                checkbox.checked = false;
            });
            
            // پاک کردن انتخاب‌های رضایت
            document.querySelectorAll('input[name="satisfaction"]').forEach(radio => {
                radio.checked = false;
            });
            
            document.querySelectorAll('input[name="advisorSatisfaction"]').forEach(radio => {
                radio.checked = false;
            });
            
            alert('فرم با موفقیت پاک شد!');
        }
        
        // پاک کردن همه داده‌ها
        function clearAllData() {
            if (confirm('آیا از پاک کردن تمام داده‌ها مطمئن هستید؟ این عمل قابل بازگشت نیست.')) {
                studyData = [];
                saveData();
                updateDataTable();
                updateCharts();
                alert('تمامی داده‌ها با موفقیت پاک شدند!');
            }
        }
        
        // به روز رسانی باکس‌های خلاصه عملکرد
        function updateSummaryBoxes() {
            const studentCode = document.getElementById('loadStudentCode').value || 'ST1001';
            const studentData = studyData.filter(item => item.studentCode === studentCode);
            
            // محاسبه جمع‌ها
            const totalSpecializedHours = studentData.reduce((sum, item) => sum + item.studyHoursSpecialized, 0);
            const totalGeneralHours = studentData.reduce((sum, item) => sum + item.studyHoursGeneral, 0);
            const totalSpecializedTests = studentData.reduce((sum, item) => sum + item.specializedTests, 0);
            const totalDescriptiveQuestions = studentData.reduce((sum, item) => sum + item.descriptiveQuestions, 0);
            const totalMarkedTests = studentData.reduce((sum, item) => sum + item.markedTests, 0);
            
            // به روز رسانی مقادیر در باکس‌ها
            document.getElementById('totalSpecializedHours').textContent = totalSpecializedHours;
            document.getElementById('totalGeneralHours').textContent = totalGeneralHours;
            document.getElementById('totalSpecializedTests').textContent = totalSpecializedTests;
            document.getElementById('totalDescriptiveQuestions').textContent = totalDescriptiveQuestions;
            document.getElementById('totalMarkedTests').textContent = totalMarkedTests;
        }
        
        // افزودن داده جدید
        function addData() {
            // بررسی احراز هویت
            if (localStorage.getItem('isAuthenticated') !== 'true') {
                alert('لطفاً ابتدا وارد سیستم شوید.');
                return;
            }
            
            const studentCode = document.getElementById('studentCode').value || 'ST1001';
            const weekNumber = parseInt(document.getElementById('weekNumber').value) || 1;
            const studyHoursSpecialized = parseInt(document.getElementById('studyHoursSpecialized').value) || 0;
            const specializedTests = parseInt(document.getElementById('specializedTests').value) || 0;
            const studyHoursGeneral = parseInt(document.getElementById('studyHoursGeneral').value) || 0;
            const descriptiveQuestions = parseInt(document.getElementById('descriptiveQuestions').value) || 0;
            const markedTests = parseInt(document.getElementById('markedTests').value) || 0;
            const examBalance = parseInt(document.getElementById('examBalance').value) || 0;
            
            // دریافت نوع آزمون
            const selectedExams = [];
            document.querySelectorAll('input[name="examType"]:checked').forEach(checkbox => {
                selectedExams.push(checkbox.value);
            });
            const examType = selectedExams.join('، ');
            
            // دریافت رضایت عملکرد
            const satisfaction = document.querySelector('input[name="satisfaction"]:checked');
            const satisfactionValue = satisfaction ? parseInt(satisfaction.value) : 3;
            
            // دریافت رضایت مشاور
            const advisorSatisfaction = document.querySelector('input[name="advisorSatisfaction"]:checked');
            const advisorSatisfactionValue = advisorSatisfaction ? parseInt(advisorSatisfaction.value) : 3;
            
            // بررسی آیا داده برای این هفته و این دانشجو قبلاً ثبت شده است
            const existingIndex = studyData.findIndex(item => 
                item.studentCode === studentCode && item.weekNumber === weekNumber
            );
            
            if (existingIndex !== -1) {
                // به روز رسانی داده موجود
                studyData[existingIndex] = {
                    studentCode,
                    weekNumber,
                    studyHoursSpecialized,
                    specializedTests,
                    studyHoursGeneral,
                    descriptiveQuestions,
                    markedTests,
                    examType,
                    examBalance,
                    satisfaction: satisfactionValue,
                    advisorSatisfaction: advisorSatisfactionValue
                };
            } else {
                // افزودن داده جدید
                studyData.push({
                    studentCode,
                    weekNumber,
                    studyHoursSpecialized,
                    specializedTests,
                    studyHoursGeneral,
                    descriptiveQuestions,
                    markedTests,
                    examType,
                    examBalance,
                    satisfaction: satisfactionValue,
                    advisorSatisfaction: advisorSatisfactionValue
                });
            }
            
            saveData();
            updateDataTable();
            updateCharts();
            
            // ریست کردن فرم
            clearForm();
            
            alert('داده با موفقیت ثبت شد!');
        }
        
        // به روز رسانی جدول داده‌ها
        function updateDataTable() {
            const table = document.getElementById('dataTable');
            table.innerHTML = '';
            
            studyData.forEach((data, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${data.studentCode}</td>
                    <td>${data.weekNumber}</td>
                    <td>${data.studyHoursSpecialized}</td>
                    <td>${data.specializedTests}</td>
                    <td>${data.studyHoursGeneral}</td>
                    <td>${data.descriptiveQuestions}</td>
                    <td>${data.markedTests}</td>
                    <td>${data.examType}</td>
                    <td>${data.examBalance}</td>
                    <td>${data.satisfaction}</td>
                    <td>${data.advisorSatisfaction}</td>
                    <td>
                        <button class="btn btn-sm btn-danger" onclick="deleteData(${index})">حذف</button>
                    </td>
                `;
                table.appendChild(row);
            });
        }
        
        // حذف داده
        function deleteData(index) {
            if (confirm('آیا از حذف این داده مطمئن هستید؟')) {
                studyData.splice(index, 1);
                saveData();
                updateDataTable();
                updateCharts();
                alert('داده با موفقیت حذف شد!');
            }
        }
        
        // به روز رسانی نمودارها
        function updateCharts() {
            const studentCode = document.getElementById('loadStudentCode').value || 'ST1001';
            const studentData = studyData.filter(item => item.studentCode === studentCode);
            
            if (studentData.length === 0) {
                return;
            }
            
            // مرتب سازی بر اساس شماره هفته
            studentData.sort((a, b) => a.weekNumber - b.weekNumber);
            
            const weeks = studentData.map(item => `هفته ${item.weekNumber}`);
            const studyHoursSpecialized = studentData.map(item => item.studyHoursSpecialized);
            const studyHoursGeneral = studentData.map(item => item.studyHoursGeneral);
            const specializedTests = studentData.map(item => item.specializedTests);
            const descriptiveQuestions = studentData.map(item => item.descriptiveQuestions);
            const markedTests = studentData.map(item => item.markedTests);
            const satisfaction = studentData.map(item => item.satisfaction);
            const advisorSatisfaction = studentData.map(item => item.advisorSatisfaction);
            const examBalance = studentData.map(item => item.examBalance);
            
            // نمودار ساعات مطالعه
            const studyHoursCtx = document.getElementById('studyHoursChart').getContext('2d');
            if (window.studyHoursChart) {
                window.studyHoursChart.destroy();
            }
            window.studyHoursChart = new Chart(studyHoursCtx, {
                type: 'line',
                data: {
                    labels: weeks,
                    datasets: [
                        {
                            label: 'ساعات تخصصی',
                            data: studyHoursSpecialized,
                            borderColor: '#6a11cb',
                            backgroundColor: 'rgba(106, 17, 203, 0.1)',
                            fill: true,
                            tension: 0.3
                        },
                        {
                            label: 'ساعات عمومی',
                            data: studyHoursGeneral,
                            borderColor: '#0ba360',
                            backgroundColor: 'rgba(11, 163, 96, 0.1)',
                            fill: true,
                            tension: 0.3
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'ساعات مطالعه در هفته'
                        }
                    }
                }
            });
            
            // نمودار تعداد تست و سوال
            const testCountCtx = document.getElementById('testCountChart').getContext('2d');
            if (window.testCountChart) {
                window.testCountChart.destroy();
            }
            window.testCountChart = new Chart(testCountCtx, {
                type: 'bar',
                data: {
                    labels: weeks,
                    datasets: [
                        {
                            label: 'تست تخصصی',
                            data: specializedTests,
                            backgroundColor: 'rgba(106, 17, 203, 0.7)'
                        },
                        {
                            label: 'سوال تشریحی',
                            data: descriptiveQuestions,
                            backgroundColor: 'rgba(11, 163, 96, 0.7)'
                        },
                        {
                            label: 'تست مارکدار',
                            data: markedTests,
                            backgroundColor: 'rgba(255, 75, 43, 0.7)'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'تعداد تست و سوال در هفته'
                        }
                    }
                }
            });
            
            // نمودار رضایت از عملکرد
            const satisfactionCtx = document.getElementById('satisfactionChart').getContext('2d');
            if (window.satisfactionChart) {
                window.satisfactionChart.destroy();
            }
            window.satisfactionChart = new Chart(satisfactionCtx, {
                type: 'line',
                data: {
                    labels: weeks,
                    datasets: [{
                        label: 'رضایت از عملکرد',
                        data: satisfaction,
                        borderColor: '#ff416c',
                        backgroundColor: 'rgba(255, 65, 108, 0.1)',
                        fill: true,
                        tension: 0.3,
                        pointRadius: 6,
                        pointHoverRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            min: 1,
                            max: 5,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'رضایت از عملکرد'
                        }
                    }
                }
            });
            
            // نمودار رضایت از مشاور
            const advisorSatisfactionCtx = document.getElementById('advisorSatisfactionChart').getContext('2d');
            if (window.advisorSatisfactionChart) {
                window.advisorSatisfactionChart.destroy();
            }
            window.advisorSatisfactionChart = new Chart(advisorSatisfactionCtx, {
                type: 'line',
                data: {
                    labels: weeks,
                    datasets: [{
                        label: 'رضایت از مشاور',
                        data: advisorSatisfaction,
                        borderColor: '#2575fc',
                        backgroundColor: 'rgba(37, 117, 252, 0.1)',
                        fill: true,
                        tension: 0.3,
                        pointRadius: 6,
                        pointHoverRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            min: 1,
                            max: 5.5, // افزایش حداکثر مقدار برای نمایش بهتر نقاط با ارزش 5
                            ticks: {
                                stepSize: 1
                            }
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'رضایت از تعامل با مشاور'
                        }
                    }
                }
            });
            
            // نمودار تراز آزمون
            const examBalanceCtx = document.getElementById('examBalanceChart').getContext('2d');
            if (window.examBalanceChart) {
                window.examBalanceChart.destroy();
            }
            
            // تعیین محدوده مناسب برای نمودار تراز آزمون
            let maxExamBalance = 5000;
            if (examBalance.length > 0) {
                maxExamBalance = Math.max(...examBalance) * 1.2;
            }
            
            window.examBalanceChart = new Chart(examBalanceCtx, {
                type: 'line',
                data: {
                    labels: weeks,
                    datasets: [{
                        label: 'تراز آزمون',
                        data: examBalance,
                        borderColor: '#ff9800',
                        backgroundColor: 'rgba(255, 152, 0, 0.1)',
                        fill: true,
                        tension: 0.3,
                        pointRadius: 6,
                        pointHoverRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            min: 0,
                            max: maxExamBalance
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'تراز آزمون آزمایشی'
                        }
                    }
                }
            });
        }
        
        // تولید گزارش گرافیکی
        function generateReport() {
            const studentCode = document.getElementById('loadStudentCode').value || 'ST1001';
            document.getElementById('selectedStudent').textContent = studentCode;
            document.getElementById('reportStudentCode').textContent = studentCode;
            
            const studentData = studyData.filter(item => item.studentCode === studentCode);
            
            if (studentData.length === 0) {
                alert('داده‌ای برای این دانشجو یافت نشد!');
                return;
            }
            
            // به روز رسانی خلاصه عملکرد در گزارش
            const totalSpecializedHours = studentData.reduce((sum, item) => sum + item.studyHoursSpecialized, 0);
            const totalGeneralHours = studentData.reduce((sum, item) => sum + item.studyHoursGeneral, 0);
            const totalSpecializedTests = studentData.reduce((sum, item) => sum + item.specializedTests, 0);
            const totalDescriptiveQuestions = studentData.reduce((sum, item) => sum + item.descriptiveQuestions, 0);
            const totalMarkedTests = studentData.reduce((sum, item) => sum + item.markedTests, 0);
            const totalWeeks = new Set(studentData.map(item => item.weekNumber)).size;
            
            document.getElementById('reportTotalSpecializedHours').textContent = totalSpecializedHours;
            document.getElementById('reportTotalGeneralHours').textContent = totalGeneralHours;
            document.getElementById('reportTotalSpecializedTests').textContent = totalSpecializedTests;
            document.getElementById('reportTotalDescriptiveQuestions').textContent = totalDescriptiveQuestions;
            document.getElementById('reportTotalMarkedTests').textContent = totalMarkedTests;
            document.getElementById('reportTotalWeeks').textContent = totalWeeks;
            
            // مرتب سازی بر اساس شماره هفته
            studentData.sort((a, b) => a.weekNumber - b.weekNumber);
            
            const weeks = studentData.map(item => `هفته ${item.weekNumber}`);
            const studyHoursSpecialized = studentData.map(item => item.studyHoursSpecialized);
            const studyHoursGeneral = studentData.map(item => item.studyHoursGeneral);
            const specializedTests = studentData.map(item => item.specializedTests);
            const descriptiveQuestions = studentData.map(item => item.descriptiveQuestions);
            const markedTests = studentData.map(item => item.markedTests);
            const satisfaction = studentData.map(item => item.satisfaction);
            const advisorSatisfaction = studentData.map(item => item.advisorSatisfaction);
            const examBalance = studentData.map(item => item.examBalance);
            
            // ایجاد نمودارهای گزارش
            createReportChart('reportStudyHoursChart', 'line', {
                labels: weeks,
                datasets: [
                    {
                        label: 'ساعات تخصصی',
                        data: studyHoursSpecialized,
                        borderColor: '#6a11cb',
                        backgroundColor: 'rgba(106, 17, 203, 0.1)',
                        fill: true,
                        tension: 0.3
                    },
                    {
                        label: 'ساعات عمومی',
                        data: studyHoursGeneral,
                        borderColor: '#0ba360',
                        backgroundColor: 'rgba(11, 163, 96, 0.1)',
                        fill: true,
                        tension: 0.3
                    }
                ]
            }, 'ساعات مطالعه در هفته');
            
            createReportChart('reportTestCountChart', 'bar', {
                labels: weeks,
                datasets: [
                    {
                        label: 'تست تخصصی',
                        data: specializedTests,
                        backgroundColor: 'rgba(106, 17, 203, 0.7)'
                    },
                    {
                        label: 'سوال تشریحی',
                        data: descriptiveQuestions,
                        backgroundColor: 'rgba(11, 163, 96, 0.7)'
                    },
                    {
                        label: 'تست مارکدار',
                        data: markedTests,
                        backgroundColor: 'rgba(255, 75, 43, 0.7)'
                    }
                ]
            }, 'تعداد تست و سوال در هفته');
            
            createReportChart('reportSatisfactionChart', 'line', {
                labels: weeks,
                datasets: [{
                    label: 'رضایت از عملکرد',
                    data: satisfaction,
                    borderColor: '#ff416c',
                    backgroundColor: 'rgba(255, 65, 108, 0.1)',
                    fill: true,
                    tension: 0.3,
                    pointRadius: 6,
                    pointHoverRadius: 8
                }]
            }, 'رضایت از عملکرد', {
                scales: {
                    y: {
                        min: 1,
                        max: 5,
                        ticks: {
                            stepSize: 1
                        }
                    }
                }
            });
            
            createReportChart('reportAdvisorSatisfactionChart', 'line', {
                labels: weeks,
                datasets: [{
                    label: 'رضایت از مشاور',
                    data: advisorSatisfaction,
                    borderColor: '#2575fc',
                    backgroundColor: 'rgba(37, 117, 252, 0.1)',
                    fill: true,
                    tension: 0.3,
                    pointRadius: 6,
                    pointHoverRadius: 8
                }]
            }, 'رضایت از تعامل با مشاور', {
                scales: {
                    y: {
                        min: 1,
                        max: 5.5, // افزایش حداکثر مقدار برای نمایش بهتر نقاط با ارزش 5
                        ticks: {
                            stepSize: 1
                        }
                    }
                }
            });
            
            // تعیین محدوده مناسب برای نمودار تراز آزمون
            let maxExamBalance = 5000;
            if (examBalance.length > 0) {
                maxExamBalance = Math.max(...examBalance) * 1.2;
            }
            
            createReportChart('reportExamBalanceChart', 'line', {
                labels: weeks,
                datasets: [{
                    label: 'تراز آزمون',
                    data: examBalance,
                    borderColor: '#ff9800',
                    backgroundColor: 'rgba(255, 152, 0, 0.1)',
                    fill: true,
                    tension: 0.3,
                    pointRadius: 6,
                    pointHoverRadius: 8
                }]
            }, 'تراز آزمون آزمایشی', {
                scales: {
                    y: {
                        min: 0,
                        max: maxExamBalance
                    }
                }
            });
            
            // تحلیل داده‌ها
            analyzeStudyData(studentData);
            
            // نمایش گزارش
            document.getElementById('graphicReport').style.display = 'block';
            
            // اسکرول به بالای صفحه
            window.scrollTo(0, 0);
        }
        
        // ایجاد نمودار در گزارش
        function createReportChart(canvasId, type, data, title, options = {}) {
            const ctx = document.getElementById(canvasId).getContext('2d');
            
            // از بین بردن نمودار قبلی اگر وجود دارد
            if (window[canvasId + 'Chart']) {
                window[canvasId + 'Chart'].destroy();
            }
            
            const defaultOptions = {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    title: {
                        display: true,
                        text: title,
                        font: {
                            size: 16
                        }
                    },
                    legend: {
                        position: 'top'
                    }
                }
            };
            
            const mergedOptions = { ...defaultOptions, ...options };
            
            window[canvasId + 'Chart'] = new Chart(ctx, {
                type: type,
                data: data,
                options: mergedOptions
            });
        }
        
        // تحلیل داده‌های تحصیلی
        function analyzeStudyData(studentData) {
            // تحلیل ساعات مطالعه
            const totalStudyHours = studentData.reduce((sum, item) => 
                sum + item.studyHoursSpecialized + item.studyHoursGeneral, 0);
            const avgStudyHours = totalStudyHours / studentData.length;
            
            let studyAnalysis = '';
            if (avgStudyHours > 40) {
                studyAnalysis = 'ساعات مطالعه شما عالی است و نشان‌دهنده پشتکار بالا و برنامه‌ریزی مناسب است.';
            } else if (avgStudyHours > 25) {
                studyAnalysis = 'ساعات مطالعه شما در سطح خوبی قرار دارد، اما هنوز ظرفیت برای افزایش آن وجود دارد.';
            } else {
                studyAnalysis = 'ساعات مطالعه شما نیاز به بهبود دارد. سعی کنید برنامه‌ریزی دقیق‌تری داشته باشید.';
            }
            
            // تحلیل تست‌زنی
            const totalTests = studentData.reduce((sum, item) => 
                sum + item.specializedTests + item.descriptiveQuestions + item.markedTests, 0);
            const avgTests = totalTests / studentData.length;
            
            let testAnalysis = '';
            if (avgTests > 300) {
                testAnalysis = 'تعداد تست‌های شما بسیار عالی است و نشان‌دهنده تمرین و تکرار کافی است.';
            } else if (avgTests > 150) {
                testAnalysis = 'تعداد تست‌های شما در سطح قابل قبولی است، اما می‌توانید آن را افزایش دهید.';
            } else {
                testAnalysis = 'تعداد تست‌های شما نیاز به بهبود دارد. سعی کنید تمرین بیشتری داشته باشید.';
            }
            
            // تحلیل رضایت
            const lastSatisfaction = studentData[studentData.length - 1].satisfaction;
            const lastAdvisorSatisfaction = studentData[studentData.length - 1].advisorSatisfaction;
            
            let satisfactionAnalysis = '';
            if (lastSatisfaction >= 4 && lastAdvisorSatisfaction >= 4) {
                satisfactionAnalysis = 'رضایت شما از عملکرد خود و تعامل با مشاور در سطح بسیار خوبی قرار دارد.';
            } else if (lastSatisfaction >= 3 && lastAdvisorSatisfaction >= 3) {
                satisfactionAnalysis = 'رضایت شما در سطح متوسط است. ممکن است نیاز به بازنگری در روش‌ها باشد.';
            } else {
                satisfactionAnalysis = 'سطح رضایت شما نیاز به توجه فوری دارد. لطفاً با مشاور خود صحبت کنید.';
            }
            
            // تحلیل تراز آزمون
            let examAnalysis = '';
            if (studentData.some(item => item.examBalance > 0)) {
                const lastExamBalance = studentData[studentData.length - 1].examBalance;
                const examType = studentData[studentData.length - 1].examType;
                
                let normalRange = 0;
                let excellentRangeMin = 0;
                let excellentRangeMax = 0;
                let maxRange = 0;
                
                if (examType.includes('ماز')) {
                    normalRange = 6500;
                    excellentRangeMin = 11000;
                    excellentRangeMax = 13000;
                    maxRange = 14000;
                } else if (examType.includes('قلمچی')) {
                    normalRange = 5500;
                    excellentRangeMin = 7000;
                    excellentRangeMax = 8000;
                    maxRange = 9000;
                } else if (examType.includes('گزینه2')) {
                    normalRange = 6000;
                    excellentRangeMin = 10000;
                    excellentRangeMax = 12000;
                    maxRange = 14000;
                } else if (examType.includes('سنجش')) {
                    normalRange = 5000;
                    excellentRangeMin = 9000;
                    excellentRangeMax = 11000;
                    maxRange = 12000;
                }
                
                if (lastExamBalance >= excellentRangeMin && lastExamBalance <= excellentRangeMax) {
                    examAnalysis = `تراز شما در آزمون ${examType} عالی است و در گروه نفرات برتر قرار دارید.`;
                } else if (lastExamBalance >= normalRange) {
                    examAnalysis = `تراز شما در آزمون ${examType} خوب است، اما هنوز ظرفیت پیشرفت دارید.`;
                } else {
                    examAnalysis = `تراز شما در آزمون ${examType} نیاز به بهبود دارد. با مشاور خود برای برنامه‌ریزی بهتر صحبت کنید.`;
                }
            } else {
                examAnalysis = 'داده‌ای از آزمون آزمایشی ثبت نشده است.';
            }
            
            // به روز رسانی متن‌های تحلیل
            document.getElementById('studyAnalysisText').textContent = studyAnalysis;
            document.getElementById('testAnalysisText').textContent = testAnalysis;
            document.getElementById('satisfactionAnalysisText').textContent = satisfactionAnalysis;
            document.getElementById('examBalanceAnalysisText').textContent = examAnalysis;
        }
        
        // بارگذاری فایل اکسل
        function loadExcelFile() {
            document.getElementById('excelInput').click();
        }
        
        document.getElementById('excelInput').addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, { type: 'array' });
                
                // فرض می‌کنیم اولین شیت حاوی داده‌ها است
                const worksheet = workbook.Sheets[workbook.SheetNames[0]];
                const jsonData = XLSX.utils.sheet_to_json(worksheet);
                
                // تبدیل داده‌های اکسل به فرمت مورد نظر
                jsonData.forEach(row => {
                    const examTypes = [];
                    if (row['ماز']) examTypes.push('ماز');
                    if (row['قلمچی']) examTypes.push('قلمچی');
                    if (row['گزینه2']) examTypes.push('گزینه2');
                    if (row['سنجش']) examTypes.push('سنجش');
                    
                    studyData.push({
                        studentCode: row['کد مراجع'] || 'ST1001',
                        weekNumber: parseInt(row['هفته']) || 1,
                        studyHoursSpecialized: parseInt(row['ساعات تخصصی']) || 0,
                        specializedTests: parseInt(row['تست تخصصی']) || 0,
                        studyHoursGeneral: parseInt(row['ساعات عمومی']) || 0,
                        descriptiveQuestions: parseInt(row['سوال تشریحی']) || 0,
                        markedTests: parseInt(row['تست مارکدار']) || 0,
                        examType: examTypes.join('، '),
                        examBalance: parseInt(row['تراز آزمون']) || 0,
                        satisfaction: parseInt(row['رضایت عملکرد']) || 3,
                        advisorSatisfaction: parseInt(row['رضایت مشاور']) || 3
                    });
                });
                
                saveData();
                updateDataTable();
                updateCharts();
                
                alert('داده‌ها از فایل اکسل با موفقیت بارگذاری شدند!');
            };
            reader.readAsArrayBuffer(file);
        });
        
        // خروجی به اکسل
        function exportToExcel() {
            if (studyData.length === 0) {
                alert('داده‌ای برای خروجی وجود ندارد!');
                return;
            }
            
            // ایجاد workbook و worksheet
            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.json_to_sheet(studyData);
            
            // اضافه کردن worksheet به workbook
            XLSX.utils.book_append_sheet(wb, ws, 'داده‌های مطالعاتی');
            
            // تولید فایل اکسل و دانلود
            XLSX.writeFile(wb, 'داده_های_مطالعاتی.xlsx');
        }
        
        // خروجی به PDF
        function exportToPDF() {
            // ابتدا گزارش گرافیکی را تولید کنید
            generateReport();
            
            // کمی تأخیر برای اطمینان از رندر کامل گزارش
            setTimeout(() => {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF('p', 'mm', 'a4');
                
                // گرفتن اسکرین‌شات از گزارش
                html2canvas(document.getElementById('graphicReport')).then(canvas => {
                    const imgData = canvas.toDataURL('image/png');
                    const imgWidth = doc.internal.pageSize.getWidth();
                    let imgHeight = canvas.height * imgWidth / canvas.width;
                    
                    // اگر ارتفاع تصویر بیشتر از یک صفحه باشد، آن را به چند صفحه تقسیم می‌کنیم
                    const remainingPageHeight = doc.internal.pageSize.getHeight() - 10;
                    let position = 0;
                    
                    doc.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                    position += remainingPageHeight;
                    
                    // اضافه کردن صفحات اضافی اگر نیاز باشد
                    while (position < imgHeight) {
                        doc.addPage();
                        doc.addImage(imgData, 'PNG', 0, -position, imgWidth, imgHeight);
                        position += remainingPageHeight;
                    }
                    
                    // ذخیره فایل PDF
                    doc.save('گزارش_تحلیل_داده_های_مطالعاتی.pdf');
                    
                    alert('گزارش PDF با موفقیت تولید و دانلود شد!');
                });
            }, 1000);
        }
        
        // بارگذاری شعر الهام بخش
        function loadInspirationalPoem() {
            const poems = [
                "راه موفقیت همیشه در حال ساخت است، موفقیت پیش رفتن است نه به نقطه پایان رسیدن.",
                "امروز خواندن، فردا رهبری است. مطالعه کلید گشودن درهای طلایی به روی آینده است.",
                "سخت‌کوشی از استعداد مهم‌تر است. استعداد بدون تلاش تنها یک پتانسیل استفاده نشده است.",
                "موفقیت مسابقه نیست، سفر است. از هر قدم لذت ببر و به پیشرفتت افتخار کن.",
                "اشتباهات نشان‌دهنده این هستند که تو در حال تلاشی، و این خود یک موفقیت است.",
                "هر روز که مطالعه می‌کنی، یک قدم به هدفت نزدیک‌تر می‌شوی. ادامه بده!",
                "امروز فردای همان دیروزیست که همواره نگرانش بودی!",
                "محدودیت‌ها تنها در ذهن ما وجود دارند. باور داشته باش که می‌توانی و نصف راه رفته‌ای.",
                "نابغه بودن یک درصد الهام و نود و نه درصد عرق ریختن است. پس به تلاش ادامه بده.",
                "موفقیت جمع چند تلاش کوچک است که هر روز و هر روز تکرار می‌شوند.",
                "آینده به کسانی تعلق دارد که به زیبایی رویاهای خود ایمان دارند. رویایت را باور کن!"
            ];
            
            const randomPoem = poems[Math.floor(Math.random() * poems.length)];
            document.getElementById('inspirationalPoem').textContent = randomPoem;
        }
        
        // بارگذاری اولیه
        window.onload = function() {
            checkAuthentication();
            loadSavedData();
            loadInspirationalPoem();
            
            // رویداد تغییر کد دانشجو
            document.getElementById('loadStudentCode').addEventListener('input', function() {
                document.getElementById('selectedStudent').textContent = this.value || 'ST1001';
                updateSummaryBoxes();
                updateCharts();
            });
            
            // مقدار اولیه برای کد دانشجو
            document.getElementById('studentCode').value = 'ST1001';
            document.getElementById('loadStudentCode').value = 'ST1001';
        };
    </script>
</body>
</html>

